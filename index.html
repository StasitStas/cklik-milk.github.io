<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Clicker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Click Counter</h1>
        <div>
            <input type="text" id="username" placeholder="Enter your name" style="display:none;" />
            <button id="startButton" style="display:none;">Start</button>
        </div>
        <div id="count">0</div>
        <button id="clickButton" class="circle-button">
            <img src="img_milky.png" alt="Click me!">
        </button>
        <div id="leaderboard">
            <h2>Leaderboard</h2>
            <ul id="leaderboardList"></ul>
        </div>
    </div>
    <script src="script.js"></script>
    <!-- Include Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js"></script>
    <!-- Add other Firebase SDKs that you need -->
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAsF7gij6UPtXbiUkcGKcVIPxPQQLERCEU",
            authDomain: "milky-clik.firebaseapp.com",
            projectId: "milky-clik",
            storageBucket: "milky-clik.appspot.com",
            messagingSenderId: "796238736121",
            appId: "1:796238736121:web:41cf1051e1be451f229028",
            measurementId: "G-SB5NK6F2XK"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        document.addEventListener('DOMContentLoaded', function() {
            const button = document.getElementById('clickButton');
            const countDisplay = document.getElementById('count');
            const leaderboardList = document.getElementById('leaderboardList');

            let username = '';
            let clickCount = 0;

            function getUsernameFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('username');
            }

            function initialize() {
                username = getUsernameFromUrl();
                if (username) {
                    db.collection("clicks").doc(username).get().then(doc => {
                        if (doc.exists) {
                            clickCount = doc.data().clickCount || 0;
                            countDisplay.textContent = clickCount;
                        } else {
                            // If the document does not exist, create it with initial clickCount value of 0
                            db.collection("clicks").doc(username).set({ clickCount: 0 });
                        }
                        updateLeaderboard();
                    }).catch(error => {
                        console.error("Error getting document:", error);
                    });
                } else {
                    alert('Помилка: Не вказано ім\'я користувача.');
                }
            }

            button.addEventListener('click', function() {
                if (username) {
                    clickCount++;
                    countDisplay.textContent = clickCount;
                    // Update clickCount value in Firestore
                    db.collection("clicks").doc(username).set({ clickCount });
                    updateLeaderboard();
                } else {
                    alert('Помилка: Не вказано ім\'я користувача.');
                }
            });

            function updateLeaderboard() {
                db.collection("clicks").orderBy("clickCount", "desc").limit(5).get().then(querySnapshot => {
                    leaderboardList.innerHTML = '';
                    let index = 0;
                    querySnapshot.forEach(doc => {
                        index++;
                        const listItem = document.createElement('li');
                        listItem.textContent = `${index}. ${doc.id}: ${doc.data().clickCount} кліків`;
                        leaderboardList.appendChild(listItem);
                    });
                }).catch(error => {
                    console.error("Error getting documents: ", error);
                });
            }

            initialize();
        });
    </script>
</body>
</html>
